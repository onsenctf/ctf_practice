# pqqp
## 解答
`chall.py` の14行目までは特におかしいところは見当たらない．15行目を見ると，秘密鍵 `d` そのものの情報ではないものの `p` , `q` から `s` という値が作られ，これが秘密の部分情報として与えられていることに気づく．ここで，`s = (p^q + q^p) mod n` という式に具体的な値をいくつか代入して観察してみると，`s = p + q` であることが分かる．`p*q` の値が分かれば `p` と `q` が求められるわけであるが，これはなんと公開鍵 `n` として既に与えられているのであった．

以上を踏まえて `p`, `q`を求めることにより秘密鍵 `d` が求まるので， 暗号文 `c` を復号できる．

`p` と `q` の求解にはsageを使う．sage のコードはやや特殊で最初は読みづらいかもしれないが，すぐにとてつもなく便利な道具であることに気づくはずである．

では，`p`と`q`を求めるコードを以下に示し，ここではその解説を行う．まず`var('p q')` で `p` と `q` を変数とした方程式を定義できるようにし， `output.txt` に基づいて `p + q = s`, `p * q = n` に対応する方程式 `e1` , `eq2` を定義する．そして `solve([eq1, eq2], p, q)` とやるだけでこの方程式が解ける (すごい) ．

`p`および`q`が求まれば後はいつものように秘密鍵 `d` を求め， 暗号文 `c` を復号し平文を`long_to_bytes` すればフラグが求まる．

```
$ python3
>>> from sage.all import *
>>> var('p q')
(p, q)
>>> eq1 = p + q == 352657755607663100038622776859029499529417617019439696287530095700910959137402713559381875825340037254723667371717152486958935653311880986170756144651263966436545612682410692937049160751729509952242950101025748701560375826993882594934424780117827552101647884709187711590428804826054603956840883672204048820926
>>> eq2 = p * q == 31091873146151684702346697466440613735531637654275447575291598179592628060572504006592135492973043411815280891993199034777719870850799089897168085047048378272819058803065113379019008507510986769455940142811531136852870338791250795366205893855348781371512284111378891370478371411301254489215000780458922500687478483283322613251724695102723186321742517119591901360757969517310504966575430365399690954997486594218980759733095291730584373437650522970915694757258900454543353223174171853107240771137143529755378972874283257666907453865488035224546093536708315002894545985583989999371144395769770808331516837626499129978673
>>> solve([eq1, eq2], p, q)
[[p == 176330063921012922700637991462863541103998854114502331637244568587102359549595630463000846482379642953757505012490743127493606379742898143117619312114492521189590382203087267098186155670651109512140181571865807227830860711167013696000707228430366770561270525802688909225479987434756271082423940874678428380699, q == 176327691686650177337984785396165958425418762904937364650285527113808599587807083096381029342960394300966162359226409359465329273568982843053136832536771445246955230479323425838863005081078400440102768529159941473729515115826868898933717551687460781540377358906498802364948817391298332874416942797525620440227], [p == 176327691686650177337984785396165958425418762904937364650285527113808599587807083096381029342960394300966162359226409359465329273568982843053136832536771445246955230479323425838863005081078400440102768529159941473729515115826868898933717551687460781540377358906498802364948817391298332874416942797525620440227, q == 176330063921012922700637991462863541103998854114502331637244568587102359549595630463000846482379642953757505012490743127493606379742898143117619312114492521189590382203087267098186155670651109512140181571865807227830860711167013696000707228430366770561270525802688909225479987434756271082423940874678428380699]]
>>> p = 176330063921012922700637991462863541103998854114502331637244568587102359549595630463000846482379642953757505012490743127493606379742898143117619312114492521189590382203087267098186155670651109512140181571865807227830860711167013696000707228430366770561270525802688909225479987434756271082423940874678428380699
>>> q = 176327691686650177337984785396165958425418762904937364650285527113808599587807083096381029342960394300966162359226409359465329273568982843053136832536771445246955230479323425838863005081078400440102768529159941473729515115826868898933717551687460781540377358906498802364948817391298332874416942797525620440227
>>> n = p*q
>>> e = 0x10001
>>> d = pow(e, -1, (p-1)*(q-1))
>>> c = 8684906481438508573968896111659984335865272165432265041057101157430256966786557751789191602935468100847192376663008622284826181320172683198164506759845864516469802014329598451852239038384416618987741292207766327548154266633297700915040296215377667970132408099403332011754465837054374292852328207923589678536677872566937644721634580238023851454550310188983635594839900790613037364784226067124711011860626624755116537552485825032787844602819348195953433376940798931002512240466327027245293290482539610349984475078766298749218537656506613924572126356742596543967759702604297374075452829941316449560673537151923549844071
>>> from Crypto.Util.number import *
>>> long_to_bytes(pow(c,d,n))
b'FLAG{p_q_p_q_521d0bd0c28300f}'
```
